<html>
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
</head>

<body>
  <div class="jumbotron">
    <h1 class="text-center">La Couleur Des Hôpitaux</h1>
  </div>

  <div class="container">
    <p>
      Entrez dans le champ ci-dessous le trigramme de l'hôpital qui vous intéresse :
    </p>

    <form class="form-inline" onkeypress="return event.keyCode != 13">
      <div class="input-group mb-3">
        <input
          id="trigram"
          class="form-control"
          type="text"
          placeholder="Trigramme"
          onkeyup="this.value = this.value.toUpperCase();"
        >
        <div class="input-group-append">
          <button id="btn-action" class="btn btn-outline-primary" type="button" onClick="addField()">+</button>
          <button id="btn-remove" class="btn btn-outline-danger "type="button" onClick="removeFields()">x</button>
        </div>
      </div>
    </form>

    <div id="container" class="row">
      <div id="container-0" class="col">
      </div>
      <div id="container-1" class="col">
      </div>
    </div>
  </div>

  <!--
  Scripts
  -->

  <script type='text/javascript'>
    function removeFields() {
      var col_1 = document.getElementById("container-0");
      var col_2 = document.getElementById("container-1");

      col_1.innerHTML = "";
      col_2.innerHTML = "";

      n_trigram = 0;
      document.getElementById("trigram").focus();
    }

    function addField() {
      // Get elements in the page
      var trigram = document.getElementById("trigram");
      var container = document.getElementById("container-" + n_trigram % 2);
      // Verify input
      if (trigram.value.length < 3) {
        return;
      } else if (trigram.value.length == 3) {
        var hexa = fromTrigram(trigram.value);
      } else if (trigram.value.length > 3) {
        var hexa = fromText(trigram.value);
      }
      // Get hexa code
      if (hexa == "."){
        return;
      }

      // Append a new line
      var form = document.createElement("form");
      form.className = "form-inline";
      var bloc = document.createElement("div");
      bloc.className = "input-group mb-3";
      var div = document.createElement("div");
      div.className = "input-group-prepend";
      var span = document.createElement("span");
      span.className = "input-group-text";
      span.style.fontFamily = "Consolas";
      var text = document.createTextNode(trigram.value.toString());
      span.appendChild(text);
      div.appendChild(span);
      bloc.appendChild(div);
      form.appendChild(bloc);

      var rgb = hexaToRGB(hexa);
      var hexa_rgb = hexa + " - " + rgb;

      var input = document.createElement("input");
      input.type = "text";
      input.className = "form-control";
      input.style.background = hexa;
      input.value = hexa_rgb;
      input.disabled = true;
      bloc.appendChild(input);
      container.appendChild(bloc);

      // Reset input value
      trigram.value = "";
      trigram.focus();
      n_trigram++;
    }

    function fromTrigram(tri) {
      var hexa = "#";
      var letter = "";
      for (i = 0; i < 3; i++) {
        letter = letterToHexa(tri[i]);
        if (letter == "."){
          return "."
        } else {
          hexa += letter;
        }
      }
      return hexa;
    }

    function fromText(text) {
      var hexa = "#";
      var tri = text.slice(0, 3);

      return fromTrigram(tri);
    }

    function letterToHexa(letter) {
      var base_36 = parseInt(letter, 36);
      var base_26 = base_36 - 10;  // No number allowed
      if (base_26 < 0){
        alert("Aucun chiffre n'est accepté");
        return ".";
      }
      var normalize = Math.round(255 * base_26 / 25);  // [255, 0]
      normalize = normalize.toString(16);
      if (normalize.length == 1) {
        normalize = "0" + normalize;
      }
      return normalize;
    }

    function hexaToRGB(hexa) {
      var r = hexa.slice(1, 3);
      var g = hexa.slice(3, 5);
      var b = hexa.slice(5);

      r = parseInt(r, 16);
      g = parseInt(g, 16);
      b = parseInt(b, 16);

      return "rgb(" + r + ", " + g + ", " + b + ")";
    }
  </script>

  <script type="text/javascript">
    var input = document.getElementById("trigram");
    input.addEventListener("keyup", function(event) {
    // Number 13 is the "Enter" key on the keyboard
    if (event.keyCode === 13) {
      event.preventDefault();
      document.getElementById("btn-action").click();
    }
  });
  </script>

  <script type="text/javascript">
    var n_trigram = 2;
  </script>
</body>
</html>
